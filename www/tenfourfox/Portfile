# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        classilla tenfourfox 812d03b96a19e70e3cba19e83790a1a929e289bb
version             20180819
categories          www
platforms           darwin
maintainers         {kencu @kencu} openmaintainer
license             GPL-2

description         clone of Firefox, compatible with macOS 10.4+
long_description    ${description}

checksums           rmd160  87499c0e7e19fc8a94de4cdd33fd09d8be73c69d \
                    sha256  02cb2d72ef2ade9d91a6734fdd521d45c25117845ed0fd32071d6e7160912b14 \
                    size    257870280

# <https://github.com/classilla/tenfourfox/wiki/HowToBuildFPR>
depends_build       port:libidl \
                    port:gcc48 \
                    port:autoconf213 \
                    port:gmake \
                    port:python27 \
                    port:freetype \
                    port:yasm \
                    port:clang-3.4

# this is hardcoded into the mozconfig build script, but here anyway as a reminder
compiler.whitelist  macports-gcc-4.8

configure.cxx_stdlib libstdc++

#select the proper config file. The nodebug config script is generally best for common use
post-extract {
    copy ${filespath}/ken-intel-nodebug.mozconfig ${worksrcpath}/.mozconfig
}

# TFF-Intel specific patches -- only 3!
patch.pre_args      -p1
patchfiles-append   patch-ots-stdlog-fix.diff
patchfiles-append   patch-ycbcr-assembly-fix.diff
patchfiles-append   patch-libvpx-makefiles-fix.diff

use_autoconf        yes
autoconf.cmd        autoconf213

use_configure       no

# not sure if this is needed or does anything, but we don't want to confuse the build with
# any macports-passed-in values at present
configure.cc
configure.cxx
configure.env

# this is needed
build.env           SHELL=/bin/bash
build.cmd           gmake -f client.mk build

# make it self-contained. This could be over-ridden if we want
pre-destroot {
    system -W ${worksrcpath} "./104fx_copy.sh TenFourFox.app"
}

destroot {
    move ${worksrcpath}/TenFourFox.app ${destroot}${applications_dir}
}
